{"ast":null,"code":"import { parseDataUrlContent } from './util';\nconst cache = {};\n\nfunction getCacheKey(url) {\n  let key = url.replace(/\\?.*/, ''); // font resourse\n\n  if (/ttf|otf|eot|woff2?/i.test(key)) {\n    key = key.replace(/.*\\//, '');\n  }\n\n  return key;\n}\n\nexport function getBlobFromURL(url, options) {\n  const cacheKey = getCacheKey(url);\n\n  if (cache[cacheKey] != null) {\n    return cache[cacheKey];\n  } // cache bypass so we dont have CORS issues with cached images\n  // ref: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n\n\n  if (options.cacheBust) {\n    // eslint-disable-next-line no-param-reassign\n    url += (/\\?/.test(url) ? '&' : '?') + new Date().getTime();\n  }\n\n  const failed = reason => {\n    let placeholder = '';\n\n    if (options.imagePlaceholder) {\n      const parts = options.imagePlaceholder.split(/,/);\n\n      if (parts && parts[1]) {\n        placeholder = parts[1];\n      }\n    }\n\n    let msg = `Failed to fetch resource: ${url}`;\n\n    if (reason) {\n      msg = typeof reason === 'string' ? reason : reason.message;\n    }\n\n    if (msg) {\n      console.error(msg);\n    }\n\n    return {\n      blob: placeholder,\n      contentType: ''\n    };\n  };\n\n  const deferred = window.fetch(url).then(res => // eslint-disable-next-line promise/no-nesting\n  res.blob().then(blob => ({\n    blob,\n    contentType: res.headers.get('Content-Type') || ''\n  }))).then(_ref => {\n    let {\n      blob,\n      contentType\n    } = _ref;\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n\n      reader.onloadend = () => resolve({\n        contentType,\n        blob: reader.result\n      });\n\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }).then(_ref2 => {\n    let {\n      blob,\n      contentType\n    } = _ref2;\n    return {\n      contentType,\n      blob: parseDataUrlContent(blob)\n    };\n  }) // on failed\n  .catch(failed); // cache result\n\n  cache[cacheKey] = deferred;\n  return deferred;\n}","map":null,"metadata":{},"sourceType":"module"}